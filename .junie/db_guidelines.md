# DB設計ガイドライン

本プロジェクトにおけるデータベース設計の共通ルールを定めます。

## 1. 命名規則

### 1.1. テーブル名
- **プレフィックス**: テーブルの性質に応じて以下のプレフィックスを付与する。
  - `m_`: マスタ系テーブル（例: `m_category`）
  - `t_`: トランザクション・データ系テーブル（例: `t_transaction`）
- **単数形/複数形**: 原則として単数形を使用する。
- **スネークケース**: 小文字とアンダースコアを使用する（例: `physical_account`）。

### 1.2. カラム名
- **プライマリキー (PK)**:
  - サロゲートキーを使用する場合は `{テーブル名}_id` または `id` を使用する。
  - マスタ系でコード値をPKにする場合は `{要素名}_cd` を使用する。
- **外部キー (FK)**:
  - 参照先テーブルのPK名を踏襲する。
- **スネークケース**: 小文字とアンダースコアを使用する。

## 2. 共通カラム

すべてのテーブル（または主要なエンティティに対応するテーブル）には、以下の監査用カラムを保持する。

| カラム名 | 型 | 制約 | 説明 |
| :--- | :--- | :--- | :--- |
| `create_at` | TIMESTAMP | NOT NULL | 作成日時 |
| `create_by` | VARCHAR(10) | NOT NULL | 作成者ID |
| `update_at` | TIMESTAMP | NOT NULL | 更新日時 |
| `update_by` | VARCHAR(10) | NOT NULL | 更新者ID |

※Java側では `AbstractAuditableEntity` を継承することでこれらを管理する。

## 3. 型の選択

- **金額**: `DECIMAL(15, 2)`（または通貨に応じた精度）を使用し、浮動小数点型 (`FLOAT`, `DOUBLE`) は避ける。
- **日付**: 日付のみの場合は `DATE`、日時が必要な場合は `TIMESTAMP` (WITH TIME ZONEを検討) を使用する。
- **論理削除**: 原則として論理削除フラグは設けず、必要に応じて履歴テーブルや状態管理で対応する。

## 4. 制約

- **NOT NULL**: 可能な限り `NOT NULL` 制約を付与し、DBレベルでデータの整合性を担保する。
- **FK制約**: 参照整合性を維持するため、必ず外部キー制約を設定する。
